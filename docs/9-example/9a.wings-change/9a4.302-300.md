---
isOriginal: true
icon: change
category:
  - 实战
  - 升迁
---

# 9A4.升迁3.0.2.300手册

build版从210升级220，有以下重点不兼容影响。

* java `17` 取代 `11`
* EE更名，以`jakarta`取代 `javax`
* boot以`3.0`取代`2.7`，[Release Notes](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Release-Notes)

## 9A4.1.修改pom.xml

version变为`3.0.2.300-SNAPSHOT`

```xml
<parent>
    <groupId>pro.fessional</groupId>
    <artifactId>wings</artifactId>
    <version>3.0.2.300-SNAPSHOT</version>
</parent>
```

## 9A4.2.依赖变更pom.xml

### [git-commit-id-plugin](https://github.com/git-commit-id/git-commit-id-maven-plugin)

```xml
<plugin>
    <groupId>pl.project13.maven</groupId>
    <artifactId>git-commit-id-plugin</artifactId>
</plugin>
<!-- ↑↑变更前↑↑，↓↓变更后↓↓ -->
<plugin>
    <groupId>io.github.git-commit-id</groupId>
    <artifactId>git-commit-id-maven-plugin</artifactId>
</plugin>
```

### [springdoc](https://springdoc.org/v2/)

```xml
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-ui</artifactId>
</dependency>
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-javadoc</artifactId>
</dependency>
<!-- ↑↑变更前↑↑，↓↓变更后↓↓ -->
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
</dependency>
```

```java
// import org.springdoc.api.annotations.ParameterObject;
import org.springdoc.core.annotations.ParameterObject;
// import org.springdoc.core.SpringDocConfiguration;
import org.springdoc.core.configuration.SpringDocConfiguration;
// import org.springdoc.core.SpringDocUtils;
import org.springdoc.core.utils.SpringDocUtils;
// import org.springdoc.core.customizers.OpenApiCustomiser;
import org.springdoc.core.customizers.OpenApiCustomizer;
```

## 9A4.3.javax to jakarta namespace

IDEA提供了迁移功能 `Refactor`/`Migrate Packages and Classes`/`JavaEE to JakartaEE`

springboot3生态下，已完成了namespace的变更。wings主要涉及以下

```java
jakarta.annotation.PostConstruct;
jakarta.mail.*
jakarta.servlet.*
jakarta.validation.*
jakarta.xml.bind.*
```

注意并非所以javax名词空间下都需要替换，有些为间接依赖，可并存，findbug等

## 9A4.4.重做Autogen

参考[277.220](9a3.277-220.md)升级手册。

因已关闭JPA注解，现涉及的javax注解如下

* javax.annotation.processing.Generated (JDK 9+)
* javax.annotation.Generated (JDK 8-)

## 9A4.5.add-modules及add-opens

java17中`--illegal-access=deny`，未`add-opens`会运行时错误。
wings的starter.sh，pom.xml，进行了正确设定，可以直接使用。

已知IDEA中，执行`Whole project`测试时，未引用surefire的`argLine`。
其结果是，部分使用反射个功能的测试用例失败。解决办法如下，

* 以模块为单位执行，会正确设置`argLine`
* 全工程时，需要自行指定`add-opens`，内容参考`argLine`。

## 9A4.6.java17的语法特征调整

java17提供了比较舒服的语法特征，^建议^调整

* PatternVariable替换类型强转 `instanceof final G g`
* 加强版的switch，以箭头表示 `case gg -> ;`
* text block 替换字符串拼接 `"""  """`

以下特征^不建议^调整

* record - 出小类外，尽量用lombok，拥有更多特性和扩展性

## 9A4.7.重要的直接依赖

* mirana 2.4.0-SNAPSHOT → 2.4.4-SNAPSHOT
* springdoc 1.6.14 → 2.0.2
  - org.springdoc:springdoc-openapi-starter-webmvc-ui
* boot-admin 2.7.10 → 3.0.0
* sentry 6.12.1 → 6.13.0
  - sentry-spring-boot-starter-jakarta
* flatten-maven-plugin 1.2.7 → 1.3.0
